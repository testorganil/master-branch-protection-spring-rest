# API Challenge branch-protection-service

## Description
A restful web service which listens to organisation events and ensures that master branch is protected whenever a new repository is created . Once the branch protection is updated a new issue is created in the repository with a mention to notify the organization's admin/owner (configurable recipient ), the issue will also contain a list of applied protections.

## Technology
Java 11, Spring boot, Maven

## Pre-requisites
- JDK-11 or above should be installed and the JAVA_HOME environment variable should be set to the JDK home directory.

- Maven should be installed and the bin directory is added to the PATH environment variable. More information https://maven.apache.org/install.html

## How to run the service
1. Download or clone the code
`git clone https://github.com/testorganil/master-branch-protection-spring-rest.git`

2. Update application.yml in src/main/resources folder with token and owner name (Check for comments inside the file for property name).
> Note: the access token is used to authenticate the updates on the repo and should have full repo access.
To create one, go to your account page and from the right top drop down menu go to 'Settings', then go to 'Developer Settings', then click 'Personal access token', now click on 'Generate new token'. Give the token a description such as "branch-protection" and select the repo full access scope then click 'Generate Token'. Now you can copy this value and set the environment variable GITHUB_TOKEN as mentioned above.

3. At this point you can build and run the service however you can't test it yet. To test the code please follow steps 4-8 first before building and running the code.
To build code: in your command line go inside the project's top directory and run:
`mvn clean package`
The previous command will generate a jar file and prompt the location of the jar file, copy the location of the jar file.
To run code:
`java -jar <JAR file path>`
> Note: This service will start on http port 8080 by default, however if this port is unavailable on your server then please add the following property to the src/main/resources/application.yml file
`server.port=<port number>` note that port number must be the same as used in step 5.

## How to test the service
In order to test the service, you need a Github account, Github Organisation, Organisation webhook and a ngork account.

4. In order to receive the events generated by the webhook on your local server you need to use ngork, install ngork by going to  
`https://ngrok.com/download` and following the instructions provided there.

5. Start ngork by giving following commands :
`ngrok authtoken <authtoken from ngork account>`
'ngrok http 8080 <<8080 unless you choose another port>>'
Copy the url which you get when you start it .

6. Create an organisation on your Github account

7. Create a new organisation webhook, go to your account ‘Settings’ and click on ‘Organisation settings’ then go to ‘Webhooks’ and click ‘Add webhook’ and enter/select the following values:
`Payload URL: <the generated ngork url from step 5>/repo/event`
`Content type: application/json;`
`Which events would you like to trigger this webhook?: Let me select individual events: Repositories;`
Click ‘Add webhook’

8. Now you can start the service as described in step 3

9. Create a new repository in your organisation. You should receive a mention notification confirming that the master branch of the new repository is protected and listing the protections applied.



> Note: if you are not receiving the notification emails in your mailbox then you may need to enable notifying your own updates by going to Settings->Notifications-> tick the checkbox called Include your own updates.
